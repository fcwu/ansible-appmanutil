---
- name: Check appmanutil
  stat:
    path: /tmp/appmanutil
  register: appmanutil

- name: Download appmanutil
  get_url:
    url: http://s3.moxa.online/v3/edge/builds/thanos-sysman/release/iotedge/v2.1.0/1592/amd64/appmanutil
    dest: /tmp/appmanutil
    mode: '0755'
  when: not appmanutil.stat.exists

- name: Scanning {{ cidr | default('10.144.48.0/24') }}
  command: /tmp/appmanutil edge scan {{ cidr | default("10.144.48.0/24") }}
  register: output

- name: Print
  debug: msg={{ output.stdout }}
# - name: long running task
#   shell: |
#     for i in `seq 30`; do
#       echo $i
#       sleep 1
#     done > /tmp/a.txt
#   async: 60
#   poll: 0
#   register: sleeper

# - name: wait
#   async_status: jid={{ sleeper.ansible_job_id }}
#   register: job_result
#   until: job_result.finished
#   retries: 30